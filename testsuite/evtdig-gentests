#!/bin/sh

test()
{
	opt="$1"
	target="$2"
	name="$3"

	echo "Test '$name'"

	filebase=testsuite/evtdig-data/"evtdig-$name"
	output="$filebase".out
	packets="$filebase".net
	rm -f "$output" "$packets"
	ATLAS_TESTS=yes ATLAS_UNSAFE=yes ./busybox evtdig $opt -O "$output" --write-response "$packets" "$target"
}

test "-6 --a www.ripe.net." manus.authdns.ripe.net "6"
test "-4 --a www.ripe.net." manus.authdns.ripe.net "4"
test "-a --a www.ripe.net." manus.authdns.ripe.net "a"
test "-R --a www.ripe.net." 8.8.8.8 "R"
test "-6 -t --a www.ripe.net." manus.authdns.ripe.net "t"
test "-A 123 -6 --a www.ripe.net." manus.authdns.ripe.net "A123"
test "-B 456 -A 123 -6 --a www.ripe.net." manus.authdns.ripe.net "B456"
test "--ad -6 --a www.ripe.net." manus.authdns.ripe.net "ad"
test "--cd -R --a www.ripe.net." 8.8.8.8 "cd"
test "--client-subnet -6 --a www.ripe.net." manus.authdns.ripe.net "client-subnet"
test "--cookies -6 --a www.ripe.net." manus.authdns.ripe.net "cookies"
test "--do -6 --a www.ripe.net." manus.authdns.ripe.net "do"
test "--edns0 1024 -6 --a www.ripe.net." manus.authdns.ripe.net "ends0-1024"
test "--edns-flags 2 -6 --a www.ripe.net." manus.authdns.ripe.net "ends-flags-2"
test "--edns-option 64 -6 --a www.ripe.net." manus.authdns.ripe.net "ends-option-64"
test "--edns-version 42 -6 --a www.ripe.net." manus.authdns.ripe.net "ends-version-42"
test "--ipv6-dest-option 128 -6 --a www.ripe.net." manus.authdns.ripe.net "ipv6-dest-option-128"
test "--noabuf -6 --a www.ripe.net." manus.authdns.ripe.net "noabuf"
test "--nsid -6 --a www.ripe.net." manus.authdns.ripe.net "nsid"
test "--p_probe_id -6 --a www.ripe.net." manus.authdns.ripe.net "p_probe_id"
test "--qbuf -6 --a www.ripe.net." manus.authdns.ripe.net "qbuf"
test "--resolv -6 --a www.ripe.net." '' "resolv"
test "--retry 3 --ipv6-dest-option 128 -6 --a www.ripe.net." manus.authdns.ripe.net "retry-3"
test "--tls -R --a www.ripe.net." 8.8.8.8 "tls"
test "-6 --https --sni_cert_name cloudflare-dns.com -R --a www.ripe.net." 2606:4700::6810:f9f9 "https"
test "--ttl -6 --a www.ripe.net." manus.authdns.ripe.net "ttl"
test "--type 12 --class 24 --query www.ripe.net." manus.authdns.ripe.net "type-class-query"
test "-6 --aaaa www.ripe.net." manus.authdns.ripe.net "aaaa"
test "-6 --any www.ripe.net." manus.authdns.ripe.net "any"
test "-6 --afsdb www.ripe.net." manus.authdns.ripe.net "afsdb"
test "-6 --apl www.ripe.net." manus.authdns.ripe.net "apl"
test "-6 --axfr www.ripe.net." manus.authdns.ripe.net "axfr"
test "-6 --caa ripe.net." manus.authdns.ripe.net "caa"
test "-6 --cert ripe.net." manus.authdns.ripe.net "cert"
test "-6 --cname atlas.ripe.net." manus.authdns.ripe.net "cname"
test "-6 --dlv ripe.net." manus.authdns.ripe.net "dlv"
test "-6 --dname ripe.net." manus.authdns.ripe.net "dname"
test "-6 --dnskey ripe.net." manus.authdns.ripe.net "dnskey"
test "-6 --ds ripe.net." manus.authdns.ripe.net "ds"
test "-6 --ipseckey ripe.net." manus.authdns.ripe.net "ipseckey"
test "-6 --loc ripe.net." manus.authdns.ripe.net "loc"
test "-6 --mx ripe.net." manus.authdns.ripe.net "mx"
test "-6 --naptr ripe.net." manus.authdns.ripe.net "naptr"
test "-6 --ns ripe.net." manus.authdns.ripe.net "ns"
test "-6 --nsec ripe.net." manus.authdns.ripe.net "nsec"
test "-6 --nsec3 ripe.net." manus.authdns.ripe.net "nsec3"
test "-6 --nsec3param ripe.net." manus.authdns.ripe.net "nsec3param"
test "-6 --ptr ripe.net." manus.authdns.ripe.net "ptr"
test "-6 --rrsig ripe.net." manus.authdns.ripe.net "rrsig"
test "-6 --rp ripe.net." manus.authdns.ripe.net "rp"
test "-6 --soa ripe.net." manus.authdns.ripe.net "soa"
test "-6 --sig ripe.net." manus.authdns.ripe.net "sig"
test "-6 --spf ripe.net." manus.authdns.ripe.net "spf"
test "-6 --sshfp ripe.net." manus.authdns.ripe.net "sshfp"
test "-6 --srv ripe.net." manus.authdns.ripe.net "srv"
test "-6 --ta ripe.net." manus.authdns.ripe.net "ta"
test "-6 --tlsa ripe.net." manus.authdns.ripe.net "tlsa"
test "-6 --txt ripe.net." manus.authdns.ripe.net "txt"
test "-6 --hostname.bind" manus.authdns.ripe.net "hostname.bind"
test "-6 --id.server" manus.authdns.ripe.net "id.server"
test "-6 --version.bind" manus.authdns.ripe.net "version.bind"
test "-6 --version.server" manus.authdns.ripe.net "version.server"
